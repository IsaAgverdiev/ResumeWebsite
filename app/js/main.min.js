(function(){"use strict";var t,i=document.createElement("div");function s(t,i,s,e){t.addEventListener(i,s,!e&&!1!==e||e)}function e(t){t.stopPropagation(),t.cancelable&&t.preventDefault()}function n(t,i,s){s=""+s,t["_s_"+i]!==s&&(t.style.setProperty(i,s),t["_s_"+i]=s)}i.innerHTML="<div class=wb-header><div class=wb-icon><span class=wb-min></span><span class=wb-max></span><span class=wb-full></span><span class=wb-close></span></div><div class=wb-title> </div></div><div class=wb-body></div><div class=wb-n></div><div class=wb-s></div><div class=wb-w></div><div class=wb-e></div><div class=wb-nw></div><div class=wb-ne></div><div class=wb-se></div><div class=wb-sw></div>";var h,o,a,r,l,m,c,u,d=[],f=0,v=0;function w(t,a){if(!(this instanceof w))return new w(t);var r,d;if(o||((h=document.body)[l="requestFullscreen"]||h[l="msRequestFullscreen"]||h[l="webkitRequestFullscreen"]||h[l="mozRequestFullscreen"]||(l=""),m=l&&l.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),s(window,"resize",(function(){c=h.clientWidth,u=h.clientHeight,p()})),c=h.clientWidth,u=h.clientHeight),this.g=i.cloneNode(!0),this.body=this.g.getElementsByClassName("wb-body")[0],t){if(a){var v=t;t=a}if("string"==typeof t)v=t;else{if(d=t.modal)var b=r="center";var y=t.id,C=t.root;v=v||t.title;var z=t.mount,E=t.html,M=t.url,N=t.width,L=t.height,k=t.minwidth,B=t.minheight;b=t.x||b,r=t.y||r;var q=t.max,F=t.top,H=t.left,R=t.bottom,T=t.right;o=t.index||o;var j=t.onclose,_=t.onfocus,W=t.onblur,D=t.onmove,P=t.onresize;a=t.background;var U=t.border,X=t.class,Y=t.splitscreen;a&&this.setBackground(a),U&&n(this.body,"margin",U+(isNaN(U)?"":"px"))}}this.setTitle(v||""),t=c,v=u,F=F?g(F,v):0,R=R?g(R,v):0,t-=(H=H?g(H,t):0)+(T=T?g(T,t):0),v-=F+R,N=N?g(N,t):t/2|0,L=L?g(L,v):v/2|0,k=k?g(k,t):0,B=B?g(B,v):0,b=b?g(b,t,N):H,r=r?g(r,v,L):F,o=o||10,this.g.id=this.id=y||"winbox-"+ ++f,this.g.className="winbox"+(X?" "+("string"==typeof X?X:X.join(" ")):"")+(d?" modal":""),this.x=b,this.y=r,this.width=N,this.height=L,this.u=k,this.s=B,this.top=F,this.right=T,this.bottom=R,this.left=H,this.max=this.min=!1,this.j=j,this.l=_,this.i=W,this.o=D,this.m=P,this.v=Y,q?this.maximize():this.move().resize(),this.focus(),z?this.mount(z):E?this.body.innerHTML=E:M&&this.setUrl(M),function(t){x(t,"title"),x(t,"n"),x(t,"s"),x(t,"w"),x(t,"e"),x(t,"nw"),x(t,"ne"),x(t,"se"),x(t,"sw"),s(t.g.getElementsByClassName("wb-min")[0],"click",(function(i){e(i),t.minimize()})),s(t.g.getElementsByClassName("wb-max")[0],"click",(function(i){e(i),t.focus().maximize()})),l?s(t.g.getElementsByClassName("wb-full")[0],"click",(function(i){e(i),t.focus().fullscreen()})):t.addClass("no-full"),s(t.g.getElementsByClassName("wb-close")[0],"click",(function(i){e(i),t.close()||(t=null)})),s(t.g,"click",(function(){t.focus()}),!1)}(this),(C||h).appendChild(this.g)}function g(t,i,s){return"string"==typeof t&&("center"===t?t=(i-s)/2|0:"right"===t||"bottom"===t?t=i-s:t="%"===(""+(s=parseFloat(t))!==t&&t.substring((""+s).length))?i/100*s|0:s),t}function b(t){d.splice(d.indexOf(t),1),p(),t.removeClass("min"),t.min=!1,t.g.title=""}function p(){for(var t,i,s=d.length,e=0;e<s;e++)t=d[e],i=Math.min((c-2*t.left)/s,250),t.resize(i+1|0,35,!0).move(t.left+e*i|0,u-t.bottom-35,!0)}function x(t,i){function n(n){if(e(n),t.min)t.minimize();else{if("title"===i){var c=Date.now(),u=c-v;if(v=c,250>u)return void t.maximize()}t.max||(h.classList.add("wb-drag"),(r=n.touches)&&(r=r[0])?(n=r,s(window,"touchmove",o),s(window,"touchend",a)):(s(window,"mousemove",o),s(window,"mouseup",a)),l=n.pageX,m=n.pageY,t.focus())}}function o(s){e(s),r&&(s=s.touches[0]);var n=s.pageX;s=s.pageY;var h,o=n-l,a=s-m;if("title"===i){t.x+=o,t.y+=a;var d=h=1}else{if("e"===i||"se"===i||"ne"===i){t.width+=o;var f=1}else"w"!==i&&"sw"!==i&&"nw"!==i||(t.x+=o,t.width-=o,d=f=1);if("s"===i||"se"===i||"sw"===i){t.height+=a;var v=1}else"n"!==i&&"ne"!==i&&"nw"!==i||(t.y+=a,t.height-=a,h=v=1)}(f||v)&&(f&&(t.width=Math.max(Math.min(t.width,c-t.x-t.right),150)),v&&(t.height=Math.max(Math.min(t.height,u-t.y-t.bottom),35)),t.resize()),(d||h)&&(d&&(t.x=Math.max(Math.min(t.x,c-t.width-t.right),t.left)),h&&(t.y=Math.max(Math.min(t.y,u-t.height-t.bottom),t.top)),t.move()),l=n,m=s}function a(t){e(t),h.classList.remove("wb-drag"),r?(window.removeEventListener("touchmove",o,!0),window.removeEventListener("touchend",a,!0)):(window.removeEventListener("mousemove",o,!0),window.removeEventListener("mouseup",a,!0))}var r,l,m,d=t.g.getElementsByClassName("wb-"+i)[0];s(d,"mousedown",n),s(d,"touchstart",n,{passive:!1})}function y(){if(a=!1,document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)return document[m](),!0}w.new=function(t){return new w(t)},(t=w.prototype).mount=function(t){return this.unmount(),t.h||(t.h=t.parentNode),this.body.textContent="",this.body.appendChild(t),this},t.unmount=function(t){var i=this.body.firstChild;if(i){var s=t||i.h;s&&s.appendChild(i),i.h=t}return this},t.setTitle=function(t){return t=this.title=t,this.g.getElementsByClassName("wb-title")[0].firstChild.nodeValue=t,this},t.setBackground=function(t){return n(this.g,"background",t),this},t.setUrl=function(t){return this.body.innerHTML='<iframe src="'+t+'"></iframe>',this},t.focus=function(){return r!==this&&(n(this.g,"z-index",o++),this.addClass("focus"),r&&(r.removeClass("focus"),r.i&&r.i()),r=this,this.l&&this.l()),this},t.hide=function(){return this.addClass("hide")},t.show=function(){return this.removeClass("hide")},t.minimize=function(t){return a&&y(),!t&&this.min?(b(this),this.resize().move().focus()):!1===t||this.min||(d.push(this),p(),this.g.title=this.title,this.addClass("min"),this.min=!0),this.max&&(this.removeClass("max"),this.max=!1),this},t.maximize=function(t){return void 0!==t&&t===this.max||(this.min&&b(this),(this.max=!this.max)?this.addClass("max").resize(c-this.left-this.right,u-this.top-this.bottom,!0).move(this.left,this.top,!0):this.resize().move().removeClass("max")),this},t.fullscreen=function(t){return void 0!==t&&t===a||(this.min&&(this.resize().move(),b(this)),a&&y()||(this.body[l](),a=!0)),this},t.close=function(t){if(this.j&&this.j(t))return!0;this.min&&b(this),this.unmount(),this.g.parentNode.removeChild(this.g),r===this&&(r=null)},t.move=function(t,i,s){return t||0===t?s||(this.x=t?t=g(t,c-this.left-this.right,this.width):0,this.y=i?i=g(i,u-this.top-this.bottom,this.height):0):(t=this.x,i=this.y,this.v&&(0===t||t===c-this.width)&&this.resize(c/2,u)),n(this.g,"transform","translate("+t+"px,"+i+"px)"),this.o&&this.o(t,i),this},t.resize=function(t,i,s){return t||0===t?s||(this.width=t?t=g(t,c-this.left-this.right):0,this.height=i?i=g(i,u-this.top-this.bottom):0):(t=this.width,i=this.height),t=Math.max(t,this.u),i=Math.max(i,this.s),n(this.g,"width",t+"px"),n(this.g,"height",i+"px"),this.m&&this.m(t,i),this},t.addClass=function(t){return this.g.classList.add(t),this},t.removeClass=function(t){return this.g.classList.remove(t),this},window.WinBox=w}).call(this);